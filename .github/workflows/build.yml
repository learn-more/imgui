name: build

on:
  push:
  pull_request:
  workflow_run:
    # Use a workflow as a trigger of scheduled builds. Forked repositories can disable scheduled builds by disabling
    # "scheduled" workflow, while maintaining ability to perform local CI builds.
    workflows:
      - scheduled
      - manual
    branches:
      - master
      - docking
      - features/premake5
    types:
      - requested

jobs:
  Build-Windows-Premake:
    runs-on: windows-2025
    name: Build - Windows - Premake

    defaults:
      run:
        working-directory: ${{ github.workspace }}/imgui

    steps:
      - uses: actions/checkout@v5
        with:
          path: ${{ github.workspace }}/imgui

      # The VulkanSDK libs for Windows is manually generated using build_windows_vulkan_libs.ps1 + attached to issue #8925.
      # (we have a .yml workflow in commit history if it becomes ever useful to create this on CI too)
      - name: Install Dependencies
        shell: powershell
        run: |
          Invoke-WebRequest -Uri "https://www.libsdl.org/release/SDL2-devel-2.32.8-VC.zip" -OutFile "SDL2-devel-2.32.8-VC.zip"
          Expand-Archive -Path SDL2-devel-2.32.8-VC.zip
          echo "SDL2_DIR=$(pwd)\SDL2-devel-2.32.8-VC\SDL2-2.32.8\" >>${env:GITHUB_ENV}

          Invoke-WebRequest -Uri "https://github.com/user-attachments/files/22464296/vulkan_windows_libs_1.4.326.zip" -OutFile vulkan_windows_libs_1.4.326.zip
          Expand-Archive -Path vulkan_windows_libs_1.4.326.zip
          echo "VULKAN_SDK=$(pwd)\vulkan_windows_libs_1.4.326\" >>${env:GITHUB_ENV}

      - name: Add premake5 to PATH
        uses: abel0b/setup-premake@v2.4
        with:
          version: "5.0.0-beta7"

      - name: Add MSBuild to PATH
        uses: microsoft/setup-msbuild@v2

      - name: Generate Visual Studio solution and project files
        shell: cmd
        run: premake5 vs2022
        working-directory: ${{ github.workspace }}/imgui/examples

      # Win64 examples are more frequently compiled than the Win32 examples.
      # More of the Win32 examples requires 'workflow_run' to reduce waste.
      - name: Build Win32 example_glfw_opengl2
        shell: cmd
        run: 'msbuild /m examples/build/example_glfw_opengl2.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_glfw_opengl3
        shell: cmd
        run: 'msbuild /m examples/build/example_glfw_opengl3.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_glfw_vulkan
        shell: cmd
        run: 'msbuild /m examples/build/example_glfw_vulkan.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_sdl2_sdlrenderer2
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_sdlrenderer2.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_sdl2_vulkan
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_vulkan.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_sdl2_opengl2
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_opengl2.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_sdl2_opengl3
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_opengl3.vcxproj /p:Platform=Win32 /p:Configuration=Release'

      - name: Build Win32 example_win32_directx9
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx9.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_win32_directx10
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx10.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_win32_directx11
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx11.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win32 example_win32_directx12
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx12.vcxproj /p:Platform=Win32 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      # Windows 64-bits
      - name: Build Win64 example_glfw_opengl2
        shell: cmd
        run: 'msbuild /m examples/build/example_glfw_opengl2.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_glfw_opengl3
        shell: cmd
        run: 'msbuild /m examples/build/example_glfw_opengl3.vcxproj /p:Platform=x64 /p:Configuration=Release'

      - name: Build Win64 example_glfw_vulkan
        shell: cmd
        run: 'msbuild /m examples/build/example_glfw_vulkan.vcxproj /p:Platform=x64 /p:Configuration=Release'

      - name: Build Win64 example_sdl2_sdlrenderer2
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_sdlrenderer2.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_sdl2_vulkan
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_vulkan.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_sdl2_opengl2
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_opengl2.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_sdl2_opengl3
        shell: cmd
        run: 'msbuild /m examples/build/example_sdl2_opengl3.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_win32_directx9
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx9.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_win32_directx10
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx10.vcxproj /p:Platform=x64 /p:Configuration=Release'
        if: github.event_name == 'workflow_run'

      - name: Build Win64 example_win32_directx11
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx11.vcxproj /p:Platform=x64 /p:Configuration=Release'

      - name: Build Win64 example_win32_directx12
        shell: cmd
        run: 'msbuild /m examples/build/example_win32_directx12.vcxproj /p:Platform=x64 /p:Configuration=Release'